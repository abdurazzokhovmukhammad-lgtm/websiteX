<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>GoalPlanner — достигни цели быстрее</title>
  <meta name="description" content="Вводи начальный депозит и цель — получай самый простой план: какая доходность или ежемесячный вклад нужен, чтобы достичь цели."/>
  <style>
    :root{
      --bg:#ffffff;
      --accent:#6b0f1a; /* бордовый */
      --muted:#222;
      --card:#fff;
      --glass: rgba(0,0,0,0.06);
      --radius:12px;
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    html,body{height:100%;margin:0;background:var(--bg);color:var(--muted);}
    .wrap{max-width:720px;margin:0 auto;padding:18px;box-sizing:border-box;}
    header{display:flex;gap:12px;align-items:center;padding:6px 0}
    .logo{width:46px;height:46px;border-radius:10px;background:linear-gradient(180deg,var(--accent),#3b0a0f);display:flex;align-items:center;justify-content:center;color:white;font-weight:700;font-size:20px}
    h1{font-size:18px;margin:0}
    .card{background:var(--card);border-radius:var(--radius);padding:14px;margin-top:12px;box-shadow:0 6px 18px rgba(0,0,0,0.06)}
    label{display:block;font-size:13px;margin-bottom:6px;color:#333}
    input[type="number"], select, .btn, input[type="text"]{
      width:100%;padding:12px;border-radius:10px;border:1px solid #eee;font-size:15px;box-sizing:border-box;
    }
    .row{display:flex;gap:8px}
    .col{flex:1}
    .controls{display:flex;gap:8px;margin-top:8px}
    .seg{display:flex;background:var(--glass);border-radius:10px;overflow:hidden}
    .seg button{flex:1;padding:10px;border:0;background:transparent;font-weight:600;color:#444}
    .seg button.active{background:var(--accent);color:white}
    .small{font-size:13px;color:#666;margin-top:6px}
    .btn{background:var(--accent);color:#fff;border:0;padding:12px;border-radius:10px;font-weight:700;margin-top:10px}
    .result{margin-top:12px;padding:12px;border-radius:10px;background:linear-gradient(180deg,#fff,#faf7f7);box-shadow:0 4px 14px rgba(107,15,26,0.06)}
    .muted{color:#666;font-size:13px}
    canvas{width:100%;height:140px;border-radius:8px;background:linear-gradient(180deg,#fff,#fcfbfb);display:block}
    .key{font-weight:700;color:var(--accent);font-size:18px}
    .badge{display:inline-block;padding:6px 8px;border-radius:999px;background:#f5f5f5;font-size:13px;color:#333;margin-right:8px}
    .foot{font-size:13px;color:#666;margin-top:10px}
    @media (max-width:420px){
      .wrap{padding:12px}
      .logo{width:44px;height:44px;font-size:18px}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo">GP</div>
      <div>
        <h1>GoalPlanner — план достижения цели</h1>
        <div class="muted">Введите депозит и желаемую сумму — получаете самый быстрый реалистичный план.</div>
      </div>
    </header>

    <div class="card">
      <label>Валюта</label>
      <select id="currency">
        <option value="USD" selected>USD ($)</option>
        <option value="EUR">EUR (€)</option>
        <option value="RUB">RUB (₽)</option>
        <option value="UZS">UZS (сум)</option>
      </select>

      <label style="margin-top:10px">Начальный депозит</label>
      <input id="deposit" type="number" min="0" placeholder="Например 1000" />

      <label style="margin-top:10px">Желаемая сумма (цель)</label>
      <input id="target" type="number" min="0" placeholder="Например 5000" />

      <div style="margin-top:10px;">
        <label>Скорость (выбери шаблон) <span class="small">или включи «Пользовательский срок»</span></label>
        <div class="seg" id="speedSeg">
          <button data-speed="fast" class="active">Быстро</button>
          <button data-speed="medium">Средне</button>
          <button data-speed="slow">Медленно</button>
        </div>
        <div class="small">Подсказка: Быстро ≈ 1 год, Средне ≈ 3 года, Медленно ≈ 5 лет. Можно задать точный срок ниже.</div>
      </div>

      <div style="margin-top:8px">
        <label><input type="checkbox" id="customToggle" />  Использовать пользовательский срок</label>
      </div>

      <div id="customBlock" style="display:none;margin-top:8px">
        <div class="row">
          <div class="col">
            <label>Значение</label>
            <input id="customValue" type="number" min="1" placeholder="Например 18" />
          </div>
          <div style="width:120px">
            <label>Единица</label>
            <select id="customUnit">
              <option value="days">Дни</option>
              <option value="weeks">Недели</option>
              <option value="months" selected>Месяцы</option>
              <option value="years">Годы</option>
            </select>
          </div>
        </div>
      </div>

      <div style="margin-top:12px;display:flex;gap:8px">
        <button class="btn" id="calcBtn">Посчитать план</button>
        <button class="btn" id="resetBtn" style="background:#f3f3f3;color:#333">Очистить</button>
      </div>

      <div class="small" style="margin-top:8px">Примечание: сайт даёт ориентиры — не инвестиционная рекомендация.</div>
    </div>

    <div id="output" style="display:none" class="card">
      <div id="summary" class="result"></div>

      <div style="margin-top:10px">
        <canvas id="chart" width="600" height="140"></canvas>
      </div>

      <div id="table" style="margin-top:12px"></div>
      <div class="foot">Позже можно добавить экспорт в PDF и ручную рекламу в верхней части страницы.</div>
    </div>
  </div>

<script>
  // Helpers
  const $ = id => document.getElementById(id);
  const fmt = (v,curr) => {
    if(isNaN(v)) return '-';
    if(curr==='UZS') return Number(v).toLocaleString('ru-RU') + ' ' + 'сум';
    if(curr==='RUB') return Number(v).toLocaleString('ru-RU') + ' ₽';
    if(curr==='EUR') return Number(v).toLocaleString('en-US',{minimumFractionDigits:2}) + ' €';
    return Number(v).toLocaleString('en-US',{style:'currency',currency:'USD'});
  };

  // UI wiring
  const seg = document.getElementById('speedSeg');
  seg.addEventListener('click', e=>{
    if(e.target.tagName!=='BUTTON') return;
    [...seg.querySelectorAll('button')].forEach(b=>b.classList.remove('active'));
    e.target.classList.add('active');
  });

  $('customToggle').addEventListener('change', e=>{
    $('customBlock').style.display = e.target.checked ? 'block' : 'none';
  });

  $('resetBtn').addEventListener('click', ()=>{
    $('deposit').value=''; $('target').value=''; $('customToggle').checked=false; $('customBlock').style.display='none';
    [...seg.querySelectorAll('button')].forEach((b,i)=> b.classList.toggle('active', i===0));
    $('output').style.display='none';
  });

  $('calcBtn').addEventListener('click', ()=> {
    const deposit = parseFloat($('deposit').value);
    const target = parseFloat($('target').value);
    const currency = $('currency').value;
    if(!deposit || !target || deposit<=0 || target<=0){ alert('Введите корректный депозит и цель'); return; }
    // Determine time horizon
    let years = null;
    if($('customToggle').checked){
      const v = parseFloat($('customValue').value);
      const unit = $('customUnit').value;
      if(!v || v<=0){ alert('Введите корректный пользовательский срок'); return; }
      if(unit==='days') years = v/365;
      if(unit==='weeks') years = (v*7)/365;
      if(unit==='months') years = v/12;
      if(unit==='years') years = v;
    } else {
      // speed mapping
      const active = seg.querySelector('button.active').dataset.speed;
      if(active==='fast') years = 1;
      else if(active==='medium') years = 3;
      else years = 5;
    }
    computePlan(deposit, target, years, currency);
  });

  // Core finance math
  function annualRateNeeded(P, A, years){
    if(A <= P) return -1; // already enough
    if(years<=0) return Infinity;
    return Math.pow(A / P, 1/years) - 1;
  }

  function monthlyContributionNeeded(P, A, years, annualRate){
    // monthly rate
    const n = Math.round(years*12);
    const r = Math.pow(1+annualRate, 1/12) - 1;
    const growthP = P * Math.pow(1+annualRate, years);
    if(n===0) return Infinity;
    const denom = (Math.pow(1+r, n) - 1) / r; // future value factor for annuity
    const requiredMonthly = (A - growthP) / denom;
    return requiredMonthly;
  }

  // Simple strategy:
  // 1) compute required annual r for chosen years: r_req
  // 2) If r_req <= realistic_threshold (25%) => recommend single-invest plan
  // 3) Else compute monthly required at DEFAULT_SAFE_ANNUAL (8% by default). If monthly reasonable -> recommend monthly plan
  // 4) Else show both numbers and mark "мало реалистично"
  function computePlan(P, A, years, currency){
    const realisticThreshold = 0.25; // 25% per year threshold for "realistic"
    const defaultAnnual = 0.08; // 8% used to compute monthly contributions alternative
    const r_req = annualRateNeeded(P, A, years);
    const r_req_pct = r_req*100;

    // compute monthly under defaultAnnual
    const monthly_req_default = monthlyContributionNeeded(P, A, years, defaultAnnual);

    // choose best option:
    let plan = {type:'', desc:'', details:{}};

    if(r_req <= 0){
      plan.type = 'already';
      plan.desc = `Ваша начальная сумма ${fmt(P,currency)} уже >= цели ${fmt(A,currency)}. Ничего не нужно делать.`;
      plan.details = {P,A,years};
    } else if(r_req <= realisticThreshold){
      plan.type = 'invest_only';
      plan.desc = `Можно достигнуть цели без регулярных вкладов при среднем годовом доходе ${ (r_req*100).toFixed(2) }% годовых.`;
      plan.details = {annualRate: r_req, years};
    } else {
      // r_req too high -> try monthly at defaultAnnual
      if(monthly_req_default > 0 && monthly_req_default < A*2){ // sanity cap
        plan.type = 'monthly_plus_invest';
        plan.desc = `Чистая инвестиционная доходность ${ (r_req*100).toFixed(1) }%/год — очень высокая. Рекомендуем альтернативу: при более реалистичных ${ (defaultAnnual*100).toFixed(1) }%/год потребуется ежемесячно вкладывать ${ fmt(monthly_req_default,currency) }.`;
        plan.details = {annualNeeded: r_req, monthlyNeeded: monthly_req_default, assumedAnnual: defaultAnnual, years};
      } else {
        plan.type = 'unlikely';
        plan.desc = `Цель достижима только при очень высокой годовой доходности ${ (r_req*100).toFixed(1) }% или при очень больших ежемесячных взносах. Это малореалистично.`;
        plan.details = {annualNeeded: r_req, monthsNeeded: monthly_req_default};
      }
    }

    renderResult(plan, P, A, years, currency);
  }

  // Render result + small chart & table
  function renderResult(plan, P, A, years, currency){
    $('output').style.display='block';
    const s = document.createElement('div');
    s.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:center">
      <div><div class="muted">Результат</div><div class="key">${plan.type==='already' ? 'Готово' : (plan.type==='invest_only' ? 'Инвестиция' : (plan.type==='monthly_plus_invest' ? 'План с вложениями' : 'Малореалистично'))}</div></div>
      <div style="text-align:right"><span class="badge">${(years>=1?years.toFixed(1)+' лет':(years*12).toFixed(0)+' мес')}</span></div>
    </div>
    <div style="margin-top:8px">${plan.desc}</div>`;

    // additional small realistic tip
    if(plan.type==='invest_only'){
      const apr = plan.details.annualRate;
      const realism = apr < 0.12 ? 'реалистично' : (apr < 0.20 ? 'возможно' : 'высокий риск');
      s.innerHTML += `<div class="small" style="margin-top:8px">Короткая оценка: <strong>${realism}</strong>. (Чем выше % — тем выше риск.)</div>`;
    } else if(plan.type==='monthly_plus_invest'){
      s.innerHTML += `<div class="small" style="margin-top:8px">Оценка: альтернатива рассчитана при ${ (plan.details.assumedAnnual*100).toFixed(1) }% годовых. Экономия времени достигается увеличением ежемесячного вклада.</div>`;
    } else if(plan.type==='unlikely'){
      s.innerHTML += `<div class="small" style="margin-top:8px;color:#b00020">Цель выглядит малореалистично — подумай увеличить срок или вклад.</div>`;
    }

    $('summary').innerHTML = '';
    $('summary').appendChild(s);

    // Build series for chart and table based on recommended plan
    let series = [];
    const nMonths = Math.round(years*12);
    let annualRate = 0;
    let monthly = 0;
    if(plan.type==='already'){
      // just flat
      series = [{m:0,val:P}];
      for(let i=1;i<=Math.min(24,nMonths);i++){
        series.push({m:i,val:P});
      }
    } else if(plan.type==='invest_only'){
      annualRate = plan.details.annualRate;
      let val = P;
      for(let i=0;i<=nMonths;i++){
        const t = i/12;
        const v = P * Math.pow(1+annualRate, t);
        series.push({m:i, val:v});
      }
    } else if(plan.type==='monthly_plus_invest'){
      annualRate = plan.details.assumedAnnual;
      monthly = plan.details.monthlyNeeded;
      let val = P;
      const rm = Math.pow(1+annualRate,1/12)-1;
      for(let i=0;i<=nMonths;i++){
        if(i===0) series.push({m:0,val:val});
        else{
          val = val*(1+rm) + monthly;
          series.push({m:i,val:val});
        }
      }
    } else {
      // unlikely -> show projection with required annual (very high) and with defaultAnnual+monthly
      annualRate = plan.details.annualNeeded;
      let val= P;
      for(let i=0;i<=Math.min(60,nMonths);i++){
        const t = i/12;
        const v = P * Math.pow(1+annualRate, t);
        series.push({m:i,val:v});
      }
    }

    drawChart(series, A);

    // table: show every 6 months or monthly up to 24 entries
    const table = $('table');
    table.innerHTML = '';
    const rows = [];
    const step = Math.max(1, Math.floor(nMonths / 12)); // show up to ~12 rows
    rows.push(`<div style="display:flex;gap:12px;flex-wrap:wrap"><div class="badge">Цель: ${fmt(A,currency)}</div><div class="badge">Депозит: ${fmt(P,currency)}</div></div>`);
    rows.push('<div style="margin-top:8px">Прогноз по месяцам (выборочные):</div>');
    rows.push('<div style="margin-top:8px">');
    rows.push('<div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">');
    for(let i=0;i<series.length;i+=step){
      const item = series[i];
      const months = item.m;
      const label = months===0 ? 'Начало' : (months%12===0 ? (months/12)+' лет' : months+' мес');
      rows.push(`<div style="padding:8px;border-radius:8px;background:#fbfbfb"><div style="font-size:13px;color:#666">${label}</div><div style="font-weight:700">${fmt(item.val,currency)}</div></div>`);
    }
    rows.push('</div></div>');
    table.innerHTML = rows.join('');

  }

  // Draw simple line chart on canvas
  function drawChart(series, target){
    const cnv = $('chart');
    const ctx = cnv.getContext('2d');
    // scale to devicePixelRatio
    const dpr = window.devicePixelRatio || 1;
    cnv.width = cnv.clientWidth * dpr;
    cnv.height = 140 * dpr;
    ctx.scale(dpr,dpr);
    // clear
    ctx.clearRect(0,0,cnv.clientWidth,140);
    // compute values
    const vals = series.map(s=>s.val);
    const maxV = Math.max(target, ...vals);
    const minV = Math.min(...vals);
    const padX = 12, padY = 12;
    const w = cnv.clientWidth - padX*2;
    const h = 140 - padY*2;
    // draw grid
    ctx.fillStyle = '#fff';
    ctx.fillRect(0,0,cnv.clientWidth,140);
    ctx.strokeStyle = '#f0f0f0';
    ctx.lineWidth = 1;
    for(let i=0;i<4;i++){
      const y = padY + (h/4)*i;
      ctx.beginPath(); ctx.moveTo(padX,y); ctx.lineTo(padX+w,y); ctx.stroke();
    }
    // draw target line
    const yTarget = padY + h * (1 - (target - minV)/(maxV - minV || 1));
    ctx.strokeStyle = 'rgba(107,15,26,0.25)';
    ctx.setLineDash([4,6]);
    ctx.beginPath(); ctx.moveTo(padX,yTarget); ctx.lineTo(padX+w,yTarget); ctx.stroke();
    ctx.setLineDash([]);

    // draw curve
    ctx.strokeStyle = 'rgba(107,15,26,0.95)';
    ctx.lineWidth = 2;
    ctx.beginPath();
    for(let i=0;i<series.length;i++){
      const x = padX + (i/(series.length-1||1)) * w;
      const y = padY + h * (1 - (series[i].val - minV)/(maxV - minV || 1));
      if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
    }
    ctx.stroke();

    // draw points (sparse)
    ctx.fillStyle = 'rgba(107,15,26,0.95)';
    for(let i=0;i<series.length;i+=Math.max(1,Math.floor(series.length/8))){
      const x = padX + (i/(series.length-1||1)) * w;
      const y = padY + h * (1 - (series[i].val - minV)/(maxV - minV || 1));
      ctx.beginPath(); ctx.arc(x,y,3,0,Math.PI*2); ctx.fill();
    }

    // label right
    ctx.fillStyle = '#444';
    ctx.font = '12px sans-serif';
    ctx.fillText('Цель', padX+6, yTarget-6);
  }
</script>
</body>
</html>
